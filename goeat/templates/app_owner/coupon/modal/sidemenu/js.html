<script>
  var couponList = document.querySelector(".couponadd_list");
  var couponInputAll = document.querySelectorAll(".couponadd_input");
  var couponItem = [
    {
      sideMenu: "감자튀김",
      stampCount: 3,
      issueDate: "21.10.10"
    },
    {
      sideMenu: "감자튀김",
      stampCount: 4,
      issueDate: "21.10.10"
    },
    {
      sideMenu: "감자튀김",
      stampCount: 5,
      issueDate: "21.10.10"
    },
  ];

  renderItem();

  function onDeleteCouponItem(index) {
    couponItem = couponItem.filter((_, i) => String(i) !== index);
    renderItem();
  }
  function onAddCouponItem() {
    const sideMenu = document.querySelector('#side_menu');
    const stampCount = document.querySelector('#stamp_count');
    const issueDate = document.querySelector('#issue_date');

    if (
      !sideMenu.value ||
      !stampCount.value ||
      !issueDate.value
    ) return alert("누락된 값이 있습니다.");

    let newItem = {
      sideMenu: sideMenu.value,
      stampCount: Number(stampCount.value),
      issueDate: issueDate.value,
    };
    couponItem = [newItem, ...couponItem];
    sideMenu.value = "";
    stampCount.value = "";
    issueDate.value = "";

    renderItem();
  }


  function renderItem() {
    couponList.innerHTML = couponItem.map((value, index) => (
      `
      <li class="item">
        <div class="order">
          <span class="order_number">
            ${index + 1}
          </span>
        </div>
        <div class="text_box">
          <p class="text">
            ${value.sideMenu}
          </p>
          <p class="text">
            ${value.stampCount}
          </p>
          <p class="text">
            ${value.issueDate}
          </p>
        </div>
        <div class="button_wrap">
          <button class="content_btn btn_fill" onclick="onDeleteCouponItem('${index}')">삭제</button>
        </div>
      </li>
      `
    )).join("")
  }

  ////////////////////////////////////////////////////////////


  var couponInput = document.querySelector(".couponadd_input");
  var couponAddNumberPad = document.querySelectorAll(".number_pad button");

  couponAddNumberPad.forEach(el => el.addEventListener('click', e => {
    if (!e.target.innerText) return onClickDelete();

    onClickNumber(e.target.innerText);
  }));

  couponInputAll.forEach(v => v.addEventListener('click', el => {
    couponInput = el.target;
  }));

  function onClickNumber(value) {

    if (couponInput.dataset.name === "스탬프갯수") {
      if (couponInput.value.length === 2) return;
    }

    if (couponInput.dataset.name === "발급일자") {
      if (couponInput.value.length === 8) return;
      couponInput.value = inputDateNumber(couponInput.value.concat(value));
      return;
    }

    couponInput.value = couponInput.value.concat(value);
  }

  function onClickDelete() {
    couponInput.value = couponInput.value.substr(0, couponInput.value.length - 1);
  }


</script>